<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticación con JWT Tokens</title>
    <link rel="stylesheet" href="../styles/dev-guias.css" />
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>    
    <header id="inicio">
        <div class="titulo-inicio">
            <h2>Guías ASP.NET Core</h2>
            <img  class="logo-main-header" src="../images/ovni-dino.png"/> 
        </div>
        <div class="header-img-container">              
            <img class="logo-tech" src="../images/asp-net-core-logo.png">
            <img class="logo-tech" src="../images/sql-server.png">
            <img class="logo-tech" src="../images/jwt-logo.png">
        </div>
    </header>  
    <nav id="navbar">              
        <header> 
            <div class="nav-header-img">
                <a class="logo-home" href="../index.html"><iconify-icon class="icon-home" icon="eva:home-fill"></iconify-icon><img  class="logo-main" src="../images/dino-face.png"/></a>
            </div>
            <h1>Autenticación con JWT Tokens</h1>               
        </header>
        <ul>
            <li><a class="nav-link" href="#inicio">Proteger una API ASP.NET Core con JWT</a></li>
            <li><a class="nav-link" href="#Requisitos_previos">Requisitos previos</a></li>
            <li><a class="nav-link" href="#Conocimientos_requeridos">Qué necesito saber</a></li>
            <li><a class="nav-link" href="#crear_tablas">Crear las tablas necesarias</a></li>
            <li><a class="nav-link" href="#code_first">Opción Code First</a></li>
            <li><a class="nav-link" href="#instalar_paquetes">Instalar Paquetes</a></li>  
            <li><a class="nav-link" href="#configuracion">Configuracion para usar el paquete JWT Bearer</a></li>  
            <li><a class="nav-link" href="#clase_jwt_admin">Emitir y valdar tokens</a></li>   
            <li><a class="nav-link" href="#probar">Probar el sistema de autenticación</a></li>   
        </ul>
    </nav>
    <main id="main-doc">        
        <section class="main-section" id="Introduccion">
            <header>Proteger una API ASP.NET Core con JWT</header>
            <article>          
                <p>
                    JWT (JSON Web Token) ofrece un sistema de autenticación para proteger y regular el acceso a los recursos de nuestra API, mediante el uso de tokens de seguridad.                    
                </p>
                <h2>Características del sistema de autenticación con JWT</h2> 
                <ul>
                    <li>Se requiere contar con un sistema de login. Para ello, es necesario crear las tablas correspondientes en nuestra base de datos.</li>
                    <li>Cuando un usuario inicia sesión, si las credenciales son válidas, recibe como resultado un token de acceso.</li>
                    <li>Para acceder a los recursos de la API será requerido incorporar este token en el header de la solicitud, para aquellos recursos que se encuentren protegidos.</li>                    
                </ul>   
                <p>
                    ASP.NET Core, también cuenta con un paquete de administración de usuarios llamado <i>Identity</i>, el cual proporciona varias funcionalidades relacionadas con la autenticación y autorización de usuarios. 
                </p>             
                <p class="notas-light">
                    <iconify-icon icon="pajamas:status-alert"></iconify-icon> En esta guía, como la intención es centrarnos en el uso de JWT, no usaremos <i>Identity</i> y nos limitaremos a usar una tabla simple de usuarios, con lo mínimo indispensable para entender cómo funciona este paquete. Si te interesa investigar cómo funciona <i>Identity</i>, podés visitar la <a href="https://learn.microsoft.com/es-es/aspnet/core/security/authentication/identity?view=aspnetcore-8.0&tabs=visual-studio">página de documentación oficial de Microsoft</a>.
                </p>
                <div class="notas">
                    NOTAS:
                    <ul>
                        <li>
                            Si te interesa investigar cómo funciona <i>Identity</i>, podés visitar la <a href="https://learn.microsoft.com/es-es/aspnet/core/security/authentication/identity?view=aspnetcore-8.0&tabs=visual-studio">página de documentación oficial de Microsoft</a>.
                        </li>
                        <li>
                            Si querés saber más sobre JWT, podés visitar el <a href="https://jwt.io/">sitio oficial de JWT</a>, donde encontrarás toda la documentación disponible.
                        </li>
                    </ul>               
                </div>
            </article>
        </section>
        <section class="main-section" id="Requisitos_previos">
            <header>Requisitos previos</header>
            <article>
                <p>Para desarrollar el proyecto propuesto en esta guía, es necesario contar con:</p>

                <ul>
                    <li>
                        Visual Studio 2022 configurado para poder crear aplicaciones ASP.NET con C#.
                    </li>
                    <li>
                        SQL Server Management Studio o Azure Data Studio.
                    </li>
                    <li>
                        Un proyecto ASP.NET Core Web API (.NET 6 o superior).
                    </li>
                    <li>
                        Postman (No es obligatorio).
                    </li>                    
                </ul>
            </article>
        </section>
        <section class="main-section" id="Conocimientos_requeridos">
            <header>Qué necesito saber</header>
            <article>
                <p>En esta guía se asume que contás con los siguientes conocimientos:</p>
                <ul>
                    <li>
                        ASP.NET Core Web API (.NET 6 o superior).
                    </li>   
                    <li>
                        Nociones básicas del protocolo HTTP.
                    </li>    
                    <li>
                        Enfoques DB First y Code First (comandos básicos en consola PM).
                    </li>                
                </ul>                                 
                <p>
                    En caso de que necesites repasar algunos conceptos acerca de cómo desarrollar una API con .NET Core, te recomiendo que eches un vistazo a la <a href="./guia-web-api.html">Guía ASP.NET Core Web API</a>, o bien podés visitar la <a href="https://learn.microsoft.com/en-us/aspnet/core/tutorials/first-web-api?view=aspnetcore-8.0&tabs=visual-studio">documentación oficial de Microsoft</a>. 
                </p>
               
            </article>
        </section>
        <section class="main-section" id="crear_tablas">
            <header>Crear las tablas necesarias</header>            
            <article>  
                <div class="notas">
                    NOTAS:
                    <ul>
                        <li>
                            Este paso es válido en caso de estar trabajando en un proyecto BD First.
                        </li>
                        <li>
                            Si se trata de un proyecto Code First, ver el apartado para <a href="#code_first"> Opción Code First</a>.
                        </li>
                    </ul>                
                </div>                          
                <p>
                    Se crea la tabla <b>Users</b> en la base de datos y, opcionalmente, se puede crear también otra tabla llamada <b>TiposUsuario</b>, si se quiere agregar distintos tipos de permisos a los usuarios (autorización).                    
                </p>   
                <p>
                    En el caso de que se quiera agregar autorización, además de la autenticación, se podría incorporar dos tipos de usuario: <i>Usuario</i> y <i>Administrador</i>. Así que se agregaran dos registros a la tabla de tipos de usuario (TiposUsuario) con estos nombres.
                </p>             
                <h2>Script T-SQL para la creación de las tablas</h2>                
                <code>                                       
                    <span class="code-main-keyword">CREATE TABLE</span> [dbo].[<span class="code-highlight">Users</span>] (
                    &nbsp;&nbsp;[Id]           INT             IDENTITY (1, 1) NOT NULL,
                    &nbsp;&nbsp;[Username]     NVARCHAR (255)  NOT NULL,
                    &nbsp;&nbsp;[PasswordHash] NVARCHAR (255)  NOT NULL,
                    &nbsp;&nbsp;[PasswordSalt] VARBINARY (MAX) NOT NULL,
                    &nbsp;&nbsp;[Status]       BIT             NULL,
                    &nbsp;&nbsp;[FechaAlta]    DATETIME        NOT NULL,
                    &nbsp;&nbsp;[TipoUsuario]    int        NOT NULL,
                    &nbsp;&nbsp;PRIMARY KEY CLUSTERED ([Id] ASC),
                    &nbsp;&nbsp;UNIQUE NONCLUSTERED ([Username] ASC)
                    );
                    
                    <span class="code-comment">/* OPCIONAL: */</span>
                    <span class="code-main-keyword">CREATE TABLE</span> <span class="code-highlight">TiposUsuario</span>(
                    &nbsp;&nbsp;Id int IDENTITY (1, 1) NOT NULL,
                    &nbsp;&nbsp;Descripcion VARCHAR (50) NOT NULL,
                    &nbsp;&nbsp;PRIMARY KEY CLUSTERED ([Id] ASC),
                    )                    
                </code>
                <h2>Script T-SQL para la Inserción de Tipos de Usuario (opcional)</h2>
                <code>
                    <span class="code-main-keyword">INSERT INTO</span> <span class="code-highlight">TiposUsuario</span> (Descripcion)
                    VALUES ('Administrador');

                    <span class="code-main-keyword">INSERT INTO</span> <span class="code-highlight">TiposUsuario</span> (Descripcion)
                    VALUES ('Usuario');
                </code>                       
            </article>
        </section>
        <section class="main-section" id="scaffold">
            <header>Traer cambios de la DB al proyecto</header>
            <article>  
                <ol>
                    <li>
                        Abrir la Consola de Administración de Paquetes.
                    </li>
                    <li>
                        <p>
                            Correr el comando <b>Scaffold-DbContext</b> de actualización, para traer las nuevas tablas de la base de datos.
                        </p>
                        <p>
                            Ejemplo:
                        </p>
                        <code>
                            <span class="code-main-keyword">Scaffold-DbContext</span> "Name=DefaultConnection" Microsoft.EntityFrameworkCore.SqlServer <span class="code-highlight">-Force</span> -OutputDir Models
                        </code>
                        <div class="notas">
                            <p>
                                Ver opciones de scaffolding en la  <a href="./guia-web-api.html#opciones_scaffold">Guía ASP.NET Core Web API</a>.
                            </p>
                        </div>
                    </li>                   
                </ol>                  
            </article>
        </section>
        <section class="main-section" id="code_first">
            <header>Opción Code First</header>
            <article>
                <h2>En caso de estar trabajando en un proyecto Code First:</h2> 
                <ol>
                    <li>
                        Crear las clases de entidad de modo que coincidan con lo propuesto para las tablas Users y TiposUsuario, descriptas en el apartado <a href="#crear_tablas">DB First</a>.
                    </li>
                    <li>
                        Abrir la Consola de Administración de Paquetes.
                    </li>
                    <li>
                        <p>
                            Correr el comando de agregar migraciones para actualizar la base de datos a partir del código.
                        </p>
                        <p>
                            Ejemplo:
                        </p>
                        <code>
                            <span class="code-highlight">Add-Migration</span> nombreDeLaMigracion
                        </code>                                               
                    </li>        
                    <li>
                        <p>
                            Correr el comando para actualizar la base de datos a partir de las migraciones generadas.
                        </p>
                        <p>
                            Ejemplo:
                        </p>
                        <code>
                            <span class="code-highlight">Update-Database</span>
                        </code>  
                    </li>           
                </ol>          
            </article>
        </section>      
         
        <section class="main-section" id="instalar_paquetes">
            <header>Instalar paquetes</header>
            <article>
                <p>Para poder utilizar el sistema de autenticación con JWT, es necesario instalar el paquete  “Microsoft.AspNetCore.Authentication.JwtBearer”</p> 
                <ol>
                    <li>
                        Abrir Administrador de paquetes NuGet.
                    </li>
                    <li>
                        Buscar e instalar el paquete <b>Microsoft.AspNetCore.Authentication.JwtBearer</b>.
                    </li>
                    <div class="notas">
                        NOTA:
                        <p>
                            Es importante que la versión del paquete coincida con la versión de .Net del proyecto.                       
                            Si la API utiliza la versión .Net 8, se debe elegir una versión 8.x.x de este paquete (ej., 8.0.2).
                        </p>
                    </div>
                </ol>          
            </article>
        </section>

        <section class="main-section" id="configuracion">
            <header>Configuracion para usar el paquete JWT Bearer</header>
            <article>
                <p>Para poder utilizar el sistema de autenticación JWT, es necesario definir algunos atributos de configuracion en appsettings.json y agregar el servicio al contenedor de servicios en Program.cs</p> 
                <h2>En appsettings.json</h2>
                <ul>
                    <li>
                        En el archivo de configuración <b>appsettings.json</b>, se agregarán los siguientes atributos:
                        <ul>
                            <li>
                                <b>Key</b>: Es una clave que servirá para generar y validar el token de acceso. 
                                <p>
                                    Se puede usar una página como <a href="https://www.random.org/strings/">random.org</a> para generar esta clave, seleccionando las opciones para incluir valores numéricos, mayúsculas y minúsculas.
                                </p>
                            </li>
                            <li>
                                <b>Issuer</b> y <b>Audience</b>: Sirven para validar la plataforma desde la cual se se efectúa la solicitud. (No obligatorio)
                            </li>
                            <li>
                                <b>TokenExpirationMinutes</b>: Indica el tiempo de expiración que se quiera determinar para el token de acceso.
                            </li>
                        </ul>                     
                    </li>
                    <li>
                        <p>
                            Ejemplo: 
                            <code>
                                "JwtSettings": {
                                    &nbsp;&nbsp;"Key": "wOajndfmty1dwuQOak68N2NadtM8HW5M",
                                    &nbsp;&nbsp;"Issuer": "https://localhost:80/",
                                    &nbsp;&nbsp;"Audience": "https://localhost:80/",
                                    &nbsp;&nbsp;"TokenExpirationMinutes": 60
                                  }
                            </code>
                        </p>
                    </li>                    
                </ul>    
                <h2>En Program.cs</h2>
                <ul>
                    <li>
                        En el archivo <b>Program.cs</b>, se agrega el servicio JwtBearer al contenedor de servicios:
                        <code>
                            var builder = WebApplication.CreateBuilder(args);

                            <span class="code-comment">//Auth - JWT Token</span>
                            <span class="code-highlight">
                            var config = builder.Configuration;

                            builder.Services.AddAuthentication(x =>
                            {
                                &nbsp;&nbsp;x.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
                                &nbsp;&nbsp;x.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
                                &nbsp;&nbsp;x.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
                            }).AddJwtBearer(x =>
                            {
                                &nbsp;&nbsp;x.TokenValidationParameters = new TokenValidationParameters
                                &nbsp;&nbsp;{
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidIssuer = config["JwtSettings:Issuer"],
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidAudience = config["JwtSettings:Audience"],
                                &nbsp;&nbsp;&nbsp;&nbsp;IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config["JwtSettings:Key"]))
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateAudience = true, 
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateIssuer = true, 
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateLifetime = true,
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateIssuerSigningKey = true
                                &nbsp;&nbsp;};
                            });

                            builder.Services.AddAuthorization();
                            
                            <span class="code-comment">// Otros servicios</span>                                
                            </span>
                            var app = builder.Build();
                        </code>
                    </li>  
                    <li>
                        Si se quiere realizar pruebas desde Swagger UI, se debe configurar Swagger para que utilice autenticación JWT Bearer:
                    </li>   
                    <!-- <code>
                        var builder = WebApplication.CreateBuilder(args);

                        <span class="code-comment">//Auth - JWT Token</span>

                            var config = builder.Configuration;

                            builder.Services.AddAuthentication(x =>
                            {
                                &nbsp;&nbsp;x.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
                                &nbsp;&nbsp;x.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
                                &nbsp;&nbsp;x.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
                            }).AddJwtBearer(x =>
                            {
                                &nbsp;&nbsp;x.TokenValidationParameters = new TokenValidationParameters
                                &nbsp;&nbsp;{
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidIssuer = config["JwtSettings:Issuer"],
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidAudience = config["JwtSettings:Audience"],
                                &nbsp;&nbsp;&nbsp;&nbsp;IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(config["JwtSettings:Key"])),       
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateAudience = true, <span class="code-comment">// Dejar en false si no se queire validar</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateIssuer = true, <span class="code-comment">// Dejar en false si no se queire validar</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateLifetime = true,
                                &nbsp;&nbsp;&nbsp;&nbsp;ValidateIssuerSigningKey = true
                                &nbsp;&nbsp;};
                            });

                            builder.Services.AddAuthorization();

                            <span class="code-highlight">
                            builder.Services.AddSwaggerGen(c =>
                            {
                            &nbsp;&nbsp;c.SwaggerDoc("v1", new OpenApiInfo { Title = "AuthTest", Version = "v1" });
                            &nbsp;&nbsp;// Configura la seguridad de Swagger para requerir un token JWT
                            &nbsp;&nbsp;c.AddSecurityDefinition("Bearer", new OpenApiSecurityScheme
                            &nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;In = ParameterLocation.Header,
                            Description = "Por favor, introduce el token JWT en este formato: Bearer <i>tu token de acceso</i><br>Separando la palabra \"Bearer\" del token por un espacio.",
                            &nbsp;&nbsp;&nbsp;&nbsp;Name = "Authorization",
                            &nbsp;&nbsp;&nbsp;&nbsp;Type = SecuritySchemeType.ApiKey
                            &nbsp;&nbsp;});
                            &nbsp;&nbsp;c.AddSecurityRequirement(new OpenApiSecurityRequirement
                            &nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new OpenApiSecurityScheme
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reference = new OpenApiReference { Type = ReferenceType.SecurityScheme, Id = "Bearer" }
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Array.Empty<<span>string</span>>()
                            &nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;});
                            });
                            </span>
                            
                            <span class="code_comment">// Otros servicios</span>                                
                        
                        var app = builder.Build();
                    </code>    -->
                </ul>            
            </article>
        </section>

        <section class="main-section" id="clase_jwt_admin">
            <header>Emitir y valdar tokens</header>
            <article>
                <p>Se crea una nueva clase con la finalidad de administrar la emisión y validación de tokens. Esta clase se va a ubicar en un directorio destinado a clases auxiliares, de utilidad para diferentes servicios y funcionalidades de la API.</p> 
                <ol>
                    <li>
                        Si no existe, crear el directorio auxiliar en la raíz del proyecto. Ej., "Helpers".
                    </li>
                    <li>
                        Dentro del directorio creado en el punto anterior, crear la clase estática <b>JwtTokenManager.cs</b>
                    </li>
                    <li>
                        En esta clase de van a definir dos métodos estáticos:
                        <ul>
                            <li>
                                Uno para generar el token, que recibe dos parámetros: las credenciales del usuario y una instancia de la interfaz <i>IConfiguration</i> para obtener la Key que registramos en appsettings.json
                            </li>
                            <li>
                                Otro para validar el token, que recibe los siguientes parámetros: el token a validar y una instancia de la interfaz <i>IConfiguration</i> para obtener la Key que registramos en appsettings.json
                            </li>
                        </ul>
                    </li>
                    <li>
                        <b>JwtTokenManager.cs</b>
                        <!-- <code>
                            public static class <span class="code-main-keyword">JwtTokenManager</span>
                            {                
                            &nbsp;&nbsp;public static string <span class="code-highlight">GenerateJwtToken</span>(User user, IConfiguration configuration)
                            &nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;var securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration["JwtSettings:Key"]));
                            &nbsp;&nbsp;&nbsp;&nbsp;var credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);                    
                            &nbsp;&nbsp;&nbsp;&nbsp;var claims = new[]
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Claim(JwtRegisteredClaimNames.Sub, user.UserName)                
                            &nbsp;&nbsp;&nbsp;&nbsp;};                    
                            &nbsp;&nbsp;&nbsp;&nbsp;int TokenExpiration = Convert.ToInt32(configuration["JwtSettings:TokenExpirationMinutes"]);                    
                            &nbsp;&nbsp;&nbsp;&nbsp;var token = new JwtSecurityToken(
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;issuer: configuration["JwtSettings:Issuer"],
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;audience: configuration["JwtSettings:Audience"],
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;claims: claims,
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires: DateTime.UtcNow.AddMinutes(TokenExpiration),
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signingCredentials: credentials
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);
                    
                            &nbsp;&nbsp;&nbsp;&nbsp;return new JwtSecurityTokenHandler().WriteToken(token);
                            &nbsp;&nbsp;}

                            &nbsp;&nbsp;public static bool <span class="code-highlight">ValidateToken</span>(string token, IConfiguration configuration)
                            &nbsp;&nbsp;{ 
                            &nbsp;&nbsp;&nbsp;&nbsp;if (!string.IsNullOrEmpty(token))
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try 
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration["JwtSettings:Key"]));
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var tokenHandler = new JwtSecurityTokenHandler();
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// Verificar validez del token.</span>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokenHandler.ValidateToken(token, new TokenValidationParameters
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidateIssuer = true, 
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidateAudience = true,
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidIssuer = configuration["JwtSettings:Issuer"],
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidAudience = configuration["JwtSettings:Audience"],
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IssuerSigningKey = securityKey,
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidateLifetime = false <span class="code-comment">// Mientras no haya registro de logs, la fecha de expiración se valida por separado para un mejor seguimiento.</span>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, out SecurityToken validatedToken);
        
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// Verificar la fecha de expiración</span>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (validatedToken is JwtSecurityToken jwtToken && jwtToken.ValidTo > DateTime.Now)
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch (Exception)
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;return false;
                            &nbsp;&nbsp;}                    
                            }    
                        </code> -->
                    </li>
                    <li>
                        Llamado a los métodos desde el controlador:
                        <!-- <code>
                            [Route("api/[controller]")]
                            [ApiController]
                            public class <span class="code-main-keyword">AuthController</span> : ControllerBase
                            {
                            &nbsp;&nbsp;private readonly IConfiguration _config;
                            &nbsp;&nbsp;private readonly AppDbContext _appDbContext;&nbsp;&nbsp;&nbsp;&nbsp;

                            &nbsp;&nbsp;public <span class="code-main-keyword">AuthController</span>(IConfiguration config, AppDbContext appDbContext)
                            &nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;   
                            &nbsp;&nbsp;&nbsp;&nbsp;_config = config;
                            &nbsp;&nbsp;&nbsp;&nbsp;_appDbContext = appDbContext;&nbsp;&nbsp;&nbsp;&nbsp;   
                            &nbsp;&nbsp;}
                           
                            &nbsp;&nbsp;[HttpPost("login")]
                            &nbsp;&nbsp;public IActionResult <span class="code-highlight">Login</span>([FromBody] UserDto loginUser)
                            &nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;bool validPass = false;
                            &nbsp;&nbsp;&nbsp;&nbsp;var user = _appDbContext.Users.FirstOrDefault(u => u.UserName.Equals(loginUser.UserName));
                            &nbsp;&nbsp;&nbsp;&nbsp;if (user != null)
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validPass = PasswordHasher.VerifyPassword(user.PasswordHash, user.PasswordSalt, loginUser.Password);
                            &nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;if (user == null || !validPass)
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Unauthorized("Credenciales inválidas");
                            &nbsp;&nbsp;&nbsp;&nbsp;}                            
                            &nbsp;&nbsp;&nbsp;&nbsp;var token = <span class="code-parametro">JwtTokenManager.GenerateJwtToken</span>(user, _config);
                            &nbsp;&nbsp;&nbsp;&nbsp;return Ok(new { Token = token });
                            &nbsp;&nbsp;}


                            &nbsp;&nbsp;[HttpPost("validate-token")]
                            &nbsp;&nbsp;public IActionResult <span class="code-highlight">ValidateToken</span>([FromHeader]string token)
                            &nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;bool tokenValido = <span class="code-parametro">JwtTokenManager.ValidateToken</span>(token, _config);
                            &nbsp;&nbsp;&nbsp;&nbsp;if (!tokenValido)
                            &nbsp;&nbsp;&nbsp;&nbsp;{
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Unauthorized("Token inválido. Inicie sesión para generar un nuevo token de acceso.");
                            &nbsp;&nbsp;&nbsp;&nbsp;}
                            &nbsp;&nbsp;&nbsp;&nbsp;return Ok("Token válido.");
                            &nbsp;&nbsp;}
                            }
                        </code> -->
                    </li>
                </ol>          
            </article>
        </section>
        <section class="main-section" id="probar">
            <header>Probar el sistemade autenticación JWT</header>
            <article>
                <ul>
                    <li>
                        Probar con Postman.
                    </li>
                    <li>
                        Probar con Swagger.
                    </li>                                    
                </ul>
                <div class="text-center">
                    <p style="font-size: 1.8rem; color: rgba(96, 173, 66);">En construcción...</p>
                    <iconify-icon  style="font-size: 100px; color: rgba(96, 173, 66);" icon="healthicons:plantation-worker-alt"></iconify-icon>
                </div>
            </article>
        </section>
        <hr>
        <footer>
            <div class="sign-div">
                <p class="titulo-sign">
                    Daniela Pinto                
                </p>
                <img id="img-titulo" src="../images/cassette.png"/>
                <p class="titulo-sign-sub">
                    Software Developer
                </p>
            </div>       
        </footer>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>